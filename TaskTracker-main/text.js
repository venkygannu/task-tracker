<div className="Container" style={{ width: 1440, height: 944, paddingLeft: 40, paddingRight: 40, background: 'white', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', gap: 10, display: 'inline-flex' }}>
  <div className="Content" style={{ alignSelf: 'stretch', height: 676.80, flexDirection: 'column', justifyContent: 'center', alignItems: 'center', gap: 20, display: 'flex' }}>
    <div className="Logo" style={{ alignSelf: 'stretch', padding: 20, borderRadius: 16, overflow: 'hidden', justifyContent: 'center', alignItems: 'center', gap: 8, display: 'inline-flex' }}>
      <img className="CompanyLogo2" style={{ width: 75, height: 76 }} src="https://via.placeholder.com/75x76" />
      <div className="Frame91" style={{ flexDirection: 'column', justifyContent: 'center', alignItems: 'flex-start', display: 'inline-flex' }}>
        <div className="Tutorsquest" style={{ color: '#8C8C8C', fontSize: 20, fontFamily: 'Lexend', fontWeight: '500', lineHeight: 20, wordWrap: 'break-word' }}>Tutorsquest</div>
        <div className="Tasktracker" style={{ color: '#262626', fontSize: 38, fontFamily: 'Lexend', fontWeight: '700', lineHeight: 46, wordWrap: 'break-word' }}>TaskTracker</div>
      </div>
    </div>
    <div className="Card" style={{ alignSelf: 'stretch', height: 540.80, padding: 40, background: 'white', boxShadow: '0px 2px 8px rgba(0, 0, 0, 0.15)', borderRadius: 16, overflow: 'hidden', border: '2px #189AB0 solid', flexDirection: 'column', justifyContent: 'flex-start', alignItems: 'flex-start', display: 'flex' }}>
      <div className="CardHead" style={{ alignSelf: 'stretch', height: 56, paddingLeft: 24, paddingRight: 24, background: 'white', boxShadow: '0px -1px 0px #F0F0F0 inset', flexDirection: 'column', justifyContent: 'flex-start', alignItems: 'flex-start', display: 'flex' }}>
        <div className="TitleWrapper" style={{ alignSelf: 'stretch', paddingTop: 12, paddingBottom: 12, justifyContent: 'flex-start', alignItems: 'center', gap: 10, display: 'inline-flex' }}>
          <div className="Title" style={{ justifyContent: 'flex-start', alignItems: 'center', gap: 4, display: 'flex' }}>
            <div className="Text" style={{ color: 'rgba(0, 0, 0, 0.85)', fontSize: 24, fontFamily: 'Lexend', fontWeight: '700', lineHeight: 32, wordWrap: 'break-word' }}>Login</div>
          </div>
        </div>
      </div>
      <div className="Body" style={{ alignSelf: 'stretch', padding: 24, background: 'white', justifyContent: 'flex-start', alignItems: 'flex-start', gap: 8, display: 'inline-flex' }}>
        <div className="Button" style={{ flex: '1 1 0', height: 42, paddingLeft: 16, paddingRight: 16, paddingTop: 8, paddingBottom: 8, background: 'white', boxShadow: '0px 2px 0px rgba(0, 0, 0, 0.02)', borderRadius: 2, border: '1px #D9D9D9 solid', justifyContent: 'center', alignItems: 'center', gap: 10, display: 'flex' }}>
          <div className="IconWrapper" style={{ background: 'rgba(255, 255, 255, 0)', flexDirection: 'column', justifyContent: 'center', alignItems: 'center', display: 'inline-flex' }}>
            <div className="Wrapper" style={{ width: 20, height: 20, position: 'relative' }}>
              <img className="Union" style={{ width: 16.78, height: 17.13, left: 1.61, top: 1.44, position: 'absolute' }} src="https://via.placeholder.com/17x17" />
            </div>
          </div>
          <div className="Text" style={{ textAlign: 'center', color: 'rgba(0, 0, 0, 0.85)', fontSize: 16, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 24, wordWrap: 'break-word' }}>Login with Google</div>
        </div>
      </div>
      <div className="Divider" style={{ alignSelf: 'stretch', justifyContent: 'center', alignItems: 'center', gap: 16, display: 'inline-flex' }}>
        <div className="Line" style={{ alignSelf: 'stretch', height: 0, border: '1px rgba(0, 0, 0, 0.12) solid' }}></div>
        <div className="TextText" style={{ height: 24, flexDirection: 'column', justifyContent: 'center', alignItems: 'flex-start', display: 'inline-flex' }}>
          <div className="Text" style={{ color: 'rgba(0, 0, 0, 0.85)', fontSize: 16, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 24, wordWrap: 'break-word' }}>or</div>
        </div>
        <div className="Line" style={{ alignSelf: 'stretch', height: 0, border: '1px rgba(0, 0, 0, 0.12) solid' }}></div>
      </div>
      <div className="Body" style={{ alignSelf: 'stretch', height: 290.80, padding: 24, background: 'white', flexDirection: 'column', justifyContent: 'flex-start', alignItems: 'flex-start', gap: 8, display: 'flex' }}>
        <div className="VerticalFormItemInput" style={{ alignSelf: 'stretch', height: 94, paddingBottom: 24, flexDirection: 'column', justifyContent: 'flex-start', alignItems: 'flex-start', display: 'flex' }}>
          <div className="Label" style={{ alignSelf: 'stretch', paddingBottom: 8, justifyContent: 'flex-start', alignItems: 'center', gap: 4, display: 'inline-flex' }}>
            <div className="Title" style={{ flex: '1 1 0', color: 'rgba(0, 0, 0, 0.85)', fontSize: 14, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 22, wordWrap: 'break-word' }}>E-Mail</div>
          </div>
          <div className="Field" style={{ alignSelf: 'stretch', background: 'white', borderRadius: 2, overflow: 'hidden', border: '1px #D9D9D9 solid', justifyContent: 'flex-start', alignItems: 'center', display: 'inline-flex' }}>
            <div className="Frame90" style={{ flex: '1 1 0', height: 40, paddingLeft: 12, paddingRight: 12, paddingTop: 8, paddingBottom: 8, background: 'white', borderRadius: 2, border: '1px #D9D9D9 solid', justifyContent: 'flex-start', alignItems: 'center', gap: 4, display: 'flex' }}>
              <div className="InputPrefix" style={{ width: 14, height: 14, position: 'relative' }}>
                <img className="Union" style={{ width: 11.75, height: 12.44, left: 1.13, top: 0.78, position: 'absolute' }} src="https://via.placeholder.com/12x12" />
              </div>
              <div className="Placeholder" style={{ flex: '1 1 0', height: 24, justifyContent: 'flex-start', alignItems: 'center', display: 'flex' }}>
                <div className="Placeholder" style={{ color: 'rgba(0, 0, 0, 0.25)', fontSize: 16, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 24, wordWrap: 'break-word' }}>Type your E-Mail Address</div>
              </div>
            </div>
          </div>
        </div>
        <div className="VerticalFormItemInput" style={{ alignSelf: 'stretch', height: 94, paddingBottom: 24, flexDirection: 'column', justifyContent: 'flex-start', alignItems: 'flex-start', display: 'flex' }}>
          <div className="Label" style={{ alignSelf: 'stretch', paddingBottom: 8, justifyContent: 'flex-start', alignItems: 'center', gap: 4, display: 'inline-flex' }}>
            <div className="Title" style={{ flex: '1 1 0', color: 'rgba(0, 0, 0, 0.85)', fontSize: 14, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 22, wordWrap: 'break-word' }}>Password</div>
          </div>
          <div className="Field" style={{ alignSelf: 'stretch', paddingLeft: 12, paddingRight: 12, paddingTop: 8, paddingBottom: 8, background: 'white', borderRadius: 2, overflow: 'hidden', border: '1px #D9D9D9 solid', justifyContent: 'flex-start', alignItems: 'center', gap: 4, display: 'inline-flex' }}>
            <div className="Wrapper" style={{ flex: '1 1 0', alignSelf: 'stretch', justifyContent: 'flex-start', alignItems: 'flex-start', gap: 130, display: 'flex' }}>
              <div className="Placeholder" style={{ color: 'rgba(0, 0, 0, 0.25)', fontSize: 16, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 24, wordWrap: 'break-word' }}>Type your Password</div>
            </div>
            <div className="Eyeinvisible" style={{ width: 16, height: 16, position: 'relative' }}>
              <div className="Vector" style={{ width: 15.57, height: 13.76, left: 0.21, top: 1.01, position: 'absolute', background: 'rgba(0, 0, 0, 0.45)' }}></div>
              <div className="Vector" style={{ width: 4.27, height: 4.27, left: 6.80, top: 6.87, position: 'absolute', background: 'rgba(0, 0, 0, 0.45)' }}></div>
            </div>
          </div>
        </div>
        <div className="Button" style={{ alignSelf: 'stretch', paddingLeft: 15, paddingRight: 15, paddingTop: 6.40, paddingBottom: 6.40, background: '#13C2C2', boxShadow: '0px 2px 0px rgba(0, 0, 0, 0.04)', borderRadius: 2, overflow: 'hidden', border: '1px #13C2C2 solid', justifyContent: 'center', alignItems: 'center', gap: 10, display: 'inline-flex' }}>
          <div className="Text" style={{ textAlign: 'center', color: 'white', fontSize: 16, fontFamily: 'Lexend', fontWeight: '400', lineHeight: 24, wordWrap: 'break-word' }}>Login</div>
        </div>
      </div>
    </div>
  </div>
</div>




import { doc, getDoc, setDoc, deleteDoc } from 'firebase/firestore';
import { db } from './firebase'; // Adjust the import path as needed

export const transferDocument = async (dispatch, sourceCollection, sourceDocId, targetCollection, targetDocId) => {
  try {
    // Step 1: Read the document from the source collection
    const sourceDocRef = doc(db, sourceCollection, sourceDocId);
    const docSnapshot = await getDoc(sourceDocRef);

    if (!docSnapshot.exists()) {
      throw new Error('Document not found in the source collection.');
    }

    const documentData = docSnapshot.data();

    // Step 2: Write the document to the target collection
    const targetDocRef = doc(db, targetCollection, targetDocId);
    await setDoc(targetDocRef, documentData);

    // Step 3: Delete the document from the source collection
    await deleteDoc(sourceDocRef);

    // Dispatch actions to update the state
    dispatch({ type: 'REMOVE_CLIENT', payload: sourceDocId });
    dispatch({ type: 'ADD_COMPLETED', payload: { ...documentData, id: targetDocId } });

    return null; // Indicating success
  } catch (error) {
    console.error('Error transferring document:', error);
    return 'An error occurred while transferring the document.'; // Return error message
  }
};



case 'REMOVE_CLIENT':
return {
  ...state,
  clients: state.clients.filter(client => client.id !== action.payload)
};
        case 'ADD_COMPLETED':
return {
  ...state,
  completed: [...state.completed, action.payload]
};



transferDocument: (sourceCollection, sourceDocId, targetCollection, targetDocId) =>
  transferDocument(dispatch, sourceCollection, sourceDocId, targetCollection, targetDocId)



const handleCompleted = async (record) => {
  const result = await transferDocument('clients', record.id, 'completed', record.id);
  if (result === null) {
    messageApi.open({
      type: 'success',
      content: 'Client completed successfully',
    });
  } else {
    messageApi.open({
      type: 'error',
      content: result,
    });
  }
};



<Popconfirm
  title="Are you sure you want to mark this client as completed?"
  onConfirm={() => handleCompleted(record)}
  okText="Yes"
  cancelText="No"
>
  <Button
    icon={<CheckCircleOutlined style={{ color: 'green' }} />}
    style={{ marginRight: 8 }}
  />
</Popconfirm>


import React, { useEffect, useState } from 'react';
import { Table, Form, Input, Select, DatePicker, Upload, Button, Badge, Tag, AutoComplete, Modal, Space, message } from 'antd';
import { PlusCircleOutlined, UploadOutlined, FileTextOutlined, EditOutlined, DeleteOutlined } from '@ant-design/icons';
import { useApp } from '../../contexts/AppContext';
import { Timestamp } from 'firebase/firestore';

const categoryOptions = [
  { value: 'Q', color: 'green' },
  { value: 'L', color: 'blue' },
  { value: 'A', color: 'orange' },
  { value: 'D', color: 'red' }
];

const statusOptions = [
  { value: 'Completed', color: 'green' },
  { value: 'Pending', color: 'yellow' },
  { value: 'Urgent', color: 'red' },
  { value: 'Overdue', color: 'purple' }
];

function OverallTasks() {
  const { setLoading, fetchClientsAndCoordinators, state, addTask } = useApp();
  const [form] = Form.useForm();
  const [expandedRows, setExpandedRows] = useState([]);
  const [visibleForms, setVisibleForms] = useState({});
  const [isNoteModalVisible, setIsNoteModalVisible] = useState(false);
  const [coordinatorOptions, setCoordinatorOptions] = useState([]);
  const [messageApi, contextHolder] = message.useMessage();

  useEffect(() => {
    const getClientsAndTasks = async () => {
      try {
        setLoading(true);
        if (Array.isArray(state.clients)) {
          console.log('fetchCandC from frontend with clients:', state.clients);
          await fetchClientsAndCoordinators(state.clients); // Make sure dispatch is available
        }
        processTeamMembers(state.teamMembers);
      } catch (error) {
        console.error("Error fetching clients, subjects, or team members:", error);
      } finally {
        setLoading(false);
      }
    };

    getClientsAndTasks();
  }, []);

  const processTeamMembers = (teamMembers) => {
    const filteredCoordinators = teamMembers.filter(member => member.role !== 'admin' && member.role !== 'manager');
    setCoordinatorOptions(filteredCoordinators.map(member => ({
      value: `${member.firstName} ${member.lastName}`,
    })));
  };

  const dataSource = state.clients
    .filter(client => client.coordinators && client.coordinators.length > 0)
    .flatMap(client =>
      client.coordinators.map(coordinator => ({
        clientId: client.id,
        key: coordinator.id,
        clientName: client.name,
        university: client.universityId,
        username: client.username,
        password: client.password,
        subject: coordinator.subjectName,
        subCode: coordinator.subjectCode,
        professor: coordinator.professor,
        coordinator: coordinator.coordinator,
      }))
    );

  const handleAddTask = (record) => {
    const newVisibleForms = { ...visibleForms };
    newVisibleForms[record.key] = !newVisibleForms[record.key];
    setVisibleForms(newVisibleForms);

    setExpandedRows(prevExpandedRows => {
      if (!prevExpandedRows.includes(record.key)) {
        return [...prevExpandedRows, record.key];
      }
      return prevExpandedRows;
    });
  };

  const showNoteModal = () => {
    setIsNoteModalVisible(true);
  };

  const handleNoteModalOk = () => {
    setIsNoteModalVisible(false);
  };

  const handleNoteModalCancel = () => {
    setIsNoteModalVisible(false);
  };

  const handleCancel = (recordKey) => {
    const newVisibleForms = { ...visibleForms };
    newVisibleForms[recordKey] = false;
    setVisibleForms(newVisibleForms);
  };

  const onFinish = async (values, record) => {
    console.log('these are the values:', values);

    const formattedValues = {
      ...values,
      dueDate: values.dueDate ? Timestamp.fromDate(values.dueDate.toDate()) : null,
      file: '', // Set the file value to empty
      activeSheet: state.activeSheet,
      clientId: record.clientId,
      coordinatorId: record.key,
    };

    try {
      await form.validateFields(); // validate the form fields first
      const result = await addTask(formattedValues);
      console.log('this is after adding the data:', state.tasks);
      if (result === null) {
        messageApi.success('Task added successfully');
        form.resetFields(); // Reset the form values
        handleCancel(record.key);
      } else {
        messageApi.error(result);
      }
    } catch (error) {
      console.error('Error adding task:', error);
      messageApi.error('An unexpected error occurred');
    }
  };

  const Addtask = ({ record }) => (
    <Form form={form} layout="inline" onFinish={(values) => onFinish(values, record)} initialValues={{ assignedTo: record.coordinator }} style={{ gap: '8px' }}>
      <Form.Item name="category" rules={[{ required: true, message: 'Please select a category!' }]}>
        <Select placeholder="Category" style={{ width: 60 }}>
          {categoryOptions.map(option => (
            <Select.Option key={option.value} value={option.value}>
              <Tag color={option.color}>{option.value}</Tag>
            </Select.Option>
          ))}
        </Select>
      </Form.Item>
      <Form.Item name="taskName" rules={[{ required: true, message: 'Please input the task name!' }]}>
        <Input placeholder="Enter Task Name" />
      </Form.Item>
      <Form.Item name="dueDate" rules={[{ required: true, message: 'Please select the due date!' }]}>
        <DatePicker placeholder="Select date" style={{ width: 120 }} />
      </Form.Item>
      <Form.Item name="grades">
        <Input placeholder="Grades" style={{ width: 60 }} />
      </Form.Item>
      <Form.Item name="status" rules={[{ required: true, message: 'Please select a status!' }]}>
        <Select placeholder="Status" style={{ width: 120 }}>
          {statusOptions.map(option => (
            <Select.Option key={option.value} value={option.value}>
              <Badge color={option.color} text={option.value} />
            </Select.Option>
          ))}
        </Select>
      </Form.Item>
      <Form.Item name="file">
        <Upload>
          <Button icon={<UploadOutlined />}>Upload</Button>
        </Upload>
      </Form.Item>
      <Form.Item>
        <Button icon={<FileTextOutlined />} onClick={showNoteModal} />
        <Modal title="Notes" visible={isNoteModalVisible} onOk={handleNoteModalOk} onCancel={handleNoteModalCancel}>
          <Input.TextArea rows={4} />
        </Modal>
      </Form.Item>
      <Form.Item name="assignedTo" rules={[{ required: true, message: 'Please assign to someone!' }]}>
        <AutoComplete
          options={coordinatorOptions}
          placeholder="Assign to"
          style={{ width: 200 }}
        />
      </Form.Item>
      <Form.Item>
        <Space>
          <Button type="primary" htmlType="submit">Done</Button>
          <Button type="default" onClick={() => handleCancel(record.key)}>Cancel</Button>
        </Space>
      </Form.Item>
    </Form>
  );

  const columns = [
    {
      title: 'Client Name',
      dataIndex: 'clientName',
      key: 'clientName',
    },
    {
      title: 'University',
      dataIndex: 'university',
      key: 'university',
    },
    {
      title: 'Username',
      dataIndex: 'username',
      key: 'username',
    },
    {
      title: 'Password',
      dataIndex: 'password',
      key: 'password',
    },
    {
      title: 'Subject',
      dataIndex: 'subject',
      key: 'subject',
    },
    {
      title: 'Sub. Code',
      dataIndex: 'subCode',
      key: 'subCode',
    },
    {
      title: 'Professor',
      dataIndex: 'professor',
      key: 'professor',
    },
    {
      title: 'Coordinator',
      dataIndex: 'coordinator',
      key: 'coordinator',
    },
    {
      key: 'actions',
      render: (text, record) => (
        <Button
          size="small"
          icon={<PlusCircleOutlined />}
          onClick={() => handleAddTask(record)}
        />
      ),
    },
  ];

  const renderActions = (task) => (
    <span>
      <Button icon={<EditOutlined />} style={{ marginRight: 8 }} size="small" />
      <Button icon={<DeleteOutlined />} style={{ marginRight: 8 }} size="small" />
    </span>
  );

  const expandedRowRender = (record) => {
    const uniqueKey = `${record.clientId}-${record.key}`;
    const taskObject = state.tasks.find(task => task.id === uniqueKey) || {};
    const tasks = taskObject.tasks?.map(task => ({ ...task, key: task.taskName })) || [];
    return (
      <div>
        {visibleForms[record.key] && <Addtask record={record} />}
        <Table
          columns={[
            { title: 'Category', dataIndex: 'category', key: 'category', render: value => <Tag color={categoryOptions.find(opt => opt.value === value)?.color}>{value}</Tag> },
            { title: 'Task Name', dataIndex: 'taskName', key: 'taskName' },
            { title: 'Due Date', dataIndex: 'dueDate', key: 'dueDate', render: date => date && date.toDate().toLocaleDateString() },
            { title: 'Grades', dataIndex: 'grades', key: 'grades' },
            { title: 'Status', dataIndex: 'status', key: 'status', render: status => <Badge color={statusOptions.find(opt => opt.value === status)?.color} text={status} /> },
            { title: 'File', dataIndex: 'file', key: 'file', render: () => <Button icon={<UploadOutlined />}>Upload</Button> },
            { title: 'Note', dataIndex: 'note', key: 'note', render: () => <Button icon={<FileTextOutlined />} onClick={showNoteModal} /> },
            { title: 'Assigned To', dataIndex: 'assignedTo', key: 'assignedTo' },
            { title: 'Actions', key: 'actions', render: renderActions },
          ]}
          dataSource={tasks}
          pagination={false}
        />
      </div>
    );
  };

  return (
    <div>
      {contextHolder}
      <Table
        columns={columns}
        expandable={{
          expandedRowRender,
        }}
        dataSource={dataSource}
        loading={state.loading}
        size="small"
      />
    </div>
  );
}

export default OverallTasks;


